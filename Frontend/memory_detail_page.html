<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>추억 상세 페이지-댓글O</title>
    <link rel="stylesheet" href="memory_detail_page.css">
    <link href="https://spoqa.github.io/spoqa-han-sans/css/SpoqaHanSansNeo.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  </head>
<body>
  <div class="container2">
    <div class="header2">
        <img src="img/logo.png" alt="Centered Image" class="center-image2">
    </div>
  </div>   
  <div class="detail_card">
    <div class="card-content">
        <div class="information">
          <p>
            <span class="date" id="group-name">그룹 이름</span>
            &nbsp; | &nbsp;
            <span class="status" id="post-visibility">공개 여부</span>
            <div class="info-buttons">
              <!-- 추억 수정하기를 누르면 팝업창 뜨도록 설정 -->
              <a href="#" onclick="showPopup(); return false;">추억 수정하기</a>
              <a class="delete" href="#" onclick="showDeletePopup(); return false;">추억 삭제하기</a>
             </div>
          </p>
        </div>
        <div class="info">
          <h2 id="post-title">게시글 제목</h2>
        </div>
        <div id="post-tags">태그들</div>
        <div class="card-content2">
        <div class="info2">
            <div class="info-item3">
                <span id="post-location">장소</span>
                &nbsp;•&nbsp;&nbsp;
                <span id="post-moment">날짜</span>
            </div>
            <div class="num1"><img src="img/flower.png" alt="꽃" id="like-count">0</div>
            <div class="num2"><img src="img/talk.png" alt="말풍선" id="comment-count">0</div>
            <div class="badge">
                <button class="like-button" id="likeBtn">
                    <img class="flower" src="img/flower.png" alt="꽃">공감 보내기
                </button>
            </div>
        </div>
    </div>
    <div class="flower-container" id="flowerContainer"></div> <!-- 꽃 이미지가 나타날 컨테이너 -->
    </div>
  </div>

  <hr style="border: 1px solid #DDDDDD; width: 75%;">

  <!-- 추억 수정하기 팝업창 -->
<div class="popup-background" id="popup-background">
    <div class="popup-content">
        <div class="container3">
            <div class="top-content">
                <h1 class="center-text">추억 수정하기</h1>
                <img src="img/X.png" class="close-icon" onclick="hidePopup()">
            </div>
            <div class="input-wrapper-container">
                <!-- Left Column (Original Content) -->
                <div class="input-wrapper">
                    <label for="nickname" class="group-name-label">닉네임</label>
                    <input type="text" id="nickname" class="group-name-input" placeholder="닉네임을 입력해 주세요.">
                    
                    <label for="title" class="group-name-label">제목</label>
                    <input type="text" id="title" class="group-name-input" placeholder="제목을 입력해 주세요.">

                    <label for="image-url" class="group-name-label">이미지</label>
                    <div class="file-upload-wrapper">
                        <input type="text" id="image-url" class="file-name-input" placeholder="파일을 선택해 주세요." readonly>
                        <label for="file-upload" class="file-upload-button">파일 선택</label>
                        <input type="file" id="file-upload" class="file-input" onchange="updateFileName()">
                    </div>

                    <label for="content" class="group-name-label">본문</label>
                    <textarea id="content" class="group-description-input" placeholder="본문 내용을 입력해 주세요."></textarea>
                </div>
                
                <!-- Divider -->
                <div class="divider"></div>

                <!-- Right Column (Duplicated Content) -->
                <div class="input-wrapper">
                    <label for="tags" class="group-name-label">태그</label>
                    <input type="text" id="tags" class="group-name-input" placeholder="태그를 입력해 주세요. (쉼표로 구분)">
                    <div class="hash-tag" id="hash-tags">
                        <!-- 해시 태그를 여기에 동적으로 추가합니다. -->
                    </div>
                    
                    <label for="location" class="group-name-label">장소</label>
                    <input type="text" id="location" class="group-name-input" placeholder="장소를 입력해 주세요.">

                    <label for="moment" class="group-name-label">추억의 순간</label>
                    <input type="date" id="moment" class="date-picker-input">

                    <label for="visibility" class="group-name-label" onclick="toggleVisibility()">추억 공개 선택</label>
                    <div class="visibility-wrapper">
                        <span id="visibility-text" class="visibility-text">공개</span>
                        <img id="visibility-icon" src="img/state=active.png" alt="Visibility Icon" class="visibility-icon">
                    </div>
                
                    <label for="post-password" class="group-name-label">비밀번호 생성</label>
                    <input type="password" id="post-password" class="group-name-input" placeholder="추억 비밀번호를 생성해 주세요.">
                </div>
            </div>

            <button class="submit-button2" id="update-button">수정하기</button>
        </div>
    </div>
</div>

    <div class="popup-background" id="delete-popup-background">
        <div class="popup-content2">
            <div class="container4">
                <div class="top-content">
                    <h1 class="center-text">추억 삭제</h1>
                    <img src="img/X.png" class="close-icon" onclick="hideDeletePopup()">
                </div>
                <div class="input-wrapper">
                    <label for="delete-password" class="group-name-label">삭제 권한 인증</label>
                    <input type="password" id="delete-password" class="group-name-input" placeholder="추억 비밀번호를 입력해 주세요.">
                </div>
            </div>
            <button class="popup-close" onclick="onDeleteButtonClick('YOUR_POST_ID_HERE')">삭제하기</button>
        </div>
    </div>

    <div class="main-content">
        <img src="img/image=img4.jpg" id="post-image"> <!-- 게시글 이미지 -->
        <p id="post-content"> <!-- 게시글 내용 -->
            인천 앞바다에서 월척을 낚았습니다!<br>
            가족들과 기억에 오래도록 남을 멋진 하루였어요 가족들과 기억에 오래도록 남을 멋진 하루였어요 가족들과 기억에 오래도록 남을 멋진 하루였어요<br>
            <br>
            인천 앞바다에서 월척을 낚았습니다!<br>
            가족들과 기억에 오래도록 남을 멋진 하루였어요<br>
            <br>
            인천 앞바다에서 월척을 낚았습니다!<br>
        </p>
        <button class="load-more" onclick="messageRegisteringPopup()">댓글 등록하기</button>
    </div>

    <div class="message-box">
        <p>댓글&nbsp;<span id="comment-count-display">0</span></p>
        <hr style="border: 1px solid #b8b8b8; width: 75%;">
        <div class="message" id="no-comments-message">
            <h2>등록된 댓글이 없습니다.</h2>
            <p>가장 먼저 댓글을 등록해보세요!</p>
        </div>
    </div>    

    <script>
        document.addEventListener("DOMContentLoaded", async function() {
            const urlParams = new URLSearchParams(window.location.search);
            const groupId = urlParams.get('groupId');
            const postId = urlParams.get('postId');
    
            if (!groupId || !postId) {
                alert("올바른 groupId와 postId가 필요합니다.");
                return;
            }
    
            // 게시글 정보 가져오기
            try {
                const response = await fetch(`/api/posts/${postId}`);
                if (!response.ok) {
                    throw new Error("게시글 정보를 불러오는 데 실패했습니다.");
                }
                const postData = await response.json();
    
                // 게시글 정보를 페이지에 반영
                document.getElementById('group-name').textContent = postData.groupName;
                document.getElementById('post-visibility').textContent = postData.isPublic ? '공개' : '비공개';
                document.getElementById('post-title').textContent = postData.title;
                
                // tags 필드를 배열로 변환
                const tagsArray = Array.isArray(postData.tags) ? postData.tags : JSON.parse(postData.tags || '[]');
                document.getElementById('post-tags').textContent = tagsArray.map(tag => `#${tag}`).join(' ');

                // 날짜 형식 yy.mm.dd 변환
                function formatDate(dateString) {
                    const date = new Date(dateString);
                    const year = date.getFullYear().toString().slice(2); // 연도 뒤 두 자리
                    const month = (date.getMonth() + 1).toString().padStart(2, '0'); // 월 두 자리
                    const day = date.getDate().toString().padStart(2, '0'); // 일 두 자리
                    return `${year}.${month}.${day}`;
                }

                document.getElementById('post-location').textContent = postData.location;
                document.getElementById('post-moment').textContent = formatDate(postData.moment);
                document.getElementById('like-count').textContent = postData.likeCount;
                document.getElementById('comment-count').textContent = postData.commentCount;
                document.getElementById('comment-count-display').textContent = postData.commentCount;
                document.getElementById('post-image').src = postData.imageUrl;
                document.getElementById('post-content').innerHTML = postData.content;
    
                // 댓글이 없을 때의 메시지
                if (postData.commentCount > 0) {
                    document.getElementById('no-comments-message').style.display = 'none';
                }
    
            } catch (error) {
                console.error('Error fetching post data:', error);
                alert('게시글 정보를 불러오는 중 오류가 발생했습니다.');
            }
        });
    </script>
    

    <script>
        // 댓글 등록 팝업을 여는 함수
        function messageRegisteringPopup() {
            document.getElementById('RegisteringPopup').style.display = 'flex';
        }

        // 댓글 등록 팝업을 닫는 함수
        function hideRegisteringPopup() {
            document.getElementById('RegisteringPopup').style.display = 'none';
        }
        // 팝업 외부를 클릭하면 닫기
        window.onclick = function(event) {
            if (event.target.classList.contains('popup-overlay')) {
                document.querySelectorAll('.popup-overlay').forEach(function(overlay) {
                    overlay.style.display = 'none';
                });
            }
        };
    </script>

    <!-- 팝업을 열고 닫는 스크립트 -->
    <script>
        function showPopup() {
            document.getElementById('popup-background').style.display = 'flex';
        }

        function hidePopup() {
            document.getElementById('popup-background').style.display = 'none';
        }
        function showDeletePopup() {
            document.getElementById('delete-popup-background').style.display = 'flex';
        }

        function hideDeletePopup() {
            document.getElementById('delete-popup-background').style.display = 'none';
        }
    </script>
    <script>
        // JavaScript for toggling visibility
        const visibilityText = document.getElementById('visibility-text');
        const visibilityIcon = document.getElementById('visibility-icon');

        let isPublic = true; // Initial state is public

        function toggleVisibility() {
        if (isPublic) {
            visibilityText.textContent = '비공개';
            visibilityIcon.src = 'img/state=default.png'; // 변경할 비공개 이미지 경로
        } else {
            visibilityText.textContent = '공개';
            visibilityIcon.src = 'img/state=active.png'; // 원래 공개 이미지 경로
        }
        isPublic = !isPublic; // Toggle state
        }

        visibilityIcon.addEventListener('click', toggleVisibility);
    </script>
    <script>
        const inputs = document.querySelectorAll('.group-name-input, .group-description-input, .file-name-input');
  
        inputs.forEach(input => {
            input.addEventListener('click', () => {
                input.classList.add('clicked');
            });
        });
    </script>
</body>
</html>
